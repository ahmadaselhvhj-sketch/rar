<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„Ø¹Ø¨Ø© Ø§Ù„Ø³Ù„ÙˆØªØ³</title>
    <style>
        body { font-family: 'Tahoma', sans-serif; background: #1a1a2e; color: #fff; text-align: center; }
        .container { max-width: 600px; margin: auto; padding: 20px; }
        .balance-box { background: #16213e; padding: 15px; border-radius: 10px; margin-bottom: 20px; }
        button { background: #0f3460; color: white; border: none; padding: 10px 20px; margin: 5px; border-radius: 5px; cursor: pointer; }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        .slots { display: flex; justify-content: center; gap: 10px; margin: 30px 0; }
        .slot { width: 80px; height: 80px; background: #0f3460; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 40px; border: 2px solid #e94560; transition: all 0.2s; }
        .spin-btn { background: #e94560; font-size: 20px; padding: 15px 40px; }
        .message { margin-top: 20px; font-size: 18px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ° Ù„Ø¹Ø¨Ø© Ø§Ù„Ø³Ù„ÙˆØªØ³</h1>
        <div id="login" style="display: none;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
        <div id="gameArea" style="display: none;">
            <div class="balance-box">
                <p>ğŸ’° Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ: <span id="realBalance">0</span></p>
                <p>ğŸ Ø±ØµÙŠØ¯ Ø§Ù„Ø¨ÙˆÙ†Øµ: <span id="bonusBalance">0</span></p>
                <p>ğŸ†” Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: <span id="userId"></span></p>
            </div>
            <div id="choiceSection">
                <p>Ø§Ø®ØªØ± Ø±ØµÙŠØ¯ Ø§Ù„Ù„Ø¹Ø¨:</p>
                <button id="playReal" class="btn">Ù„Ø¹Ø¨ Ø¨Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</button>
                <button id="playBonus" class="btn">Ù„Ø¹Ø¨ Ø¨Ø±ØµÙŠØ¯ Ø§Ù„Ø¨ÙˆÙ†Øµ</button>
            </div>
            <div id="gameSection" style="display: none;">
                <div class="slots" id="slots">
                    <div class="slot">ğŸ’</div>
                    <div class="slot">ğŸ’</div>
                    <div class="slot">ğŸ’</div>
                    <div class="slot">ğŸ’</div>
                    <div class="slot">ğŸ’</div>
                </div>
                <button class="spin-btn" id="spinBtn">ğŸ”„ ØªØ¯ÙˆÙŠØ± (1000)</button>
                <div class="message" id="message"></div>
            </div>
        </div>
    </div>
    <script>
        // Ø§Ø³ØªØ®Ø±Ø§Ø¬ userid Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·
        const urlParams = new URLSearchParams(window.location.search);
        const userId = urlParams.get('userid');
        if (!userId) {
            document.body.innerHTML = '<h2>âŒ Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h2>';
        } else {
            document.getElementById('userId').innerText = userId;
        }

        // Ø±Ø§Ø¨Ø· Google Apps Script (Ø§Ø³ØªØ¨Ø¯Ù„ Ø¨Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ)
        const appsScriptUrl = 'https://script.google.com/macros/s/AKfycbwU4ZYlIhpqlxHdOuC6IZKH5Tdyoz3ciM88fULuQCeZFn2fO28DCJ-VrSSb9g9ypUfV/exec';

        let userData = null;
        let currentPlayBalance = null; // 'real' or 'bonus'
        let symbols = ['ğŸ’', 'ğŸ‹', 'ğŸŠ', 'ğŸ‡', 'ğŸ’', '7ï¸âƒ£', 'â­'];

        // Ø¯Ø§Ù„Ø© Ù„Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        async function loadUserData() {
            try {
                const response = await fetch(`${appsScriptUrl}?action=getUser&userId=${userId}`);
                userData = await response.json();
                if (userData.error) throw new Error(userData.error);
                document.getElementById('realBalance').innerText = userData.balance;
                document.getElementById('bonusBalance').innerText = userData.bonus_balance;
                document.getElementById('login').style.display = 'none';
                document.getElementById('gameArea').style.display = 'block';
            } catch (e) {
                document.getElementById('login').innerHTML = 'âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + e.message;
            }
        }

        // Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ø±ØµÙŠØ¯
        document.getElementById('playReal').addEventListener('click', () => {
            if (userData.balance < 1000) {
                alert('Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø£Ù‚Ù„ Ù…Ù† 1000');
                return;
            }
            currentPlayBalance = 'real';
            startGame();
        });
        document.getElementById('playBonus').addEventListener('click', () => {
            if (userData.bonus_balance < 1000) {
                alert('Ø±ØµÙŠØ¯ Ø§Ù„Ø¨ÙˆÙ†Øµ Ø£Ù‚Ù„ Ù…Ù† 1000');
                return;
            }
            currentPlayBalance = 'bonus';
            startGame();
        });

        function startGame() {
            document.getElementById('choiceSection').style.display = 'none';
            document.getElementById('gameSection').style.display = 'block';
        }

        // Ø¯Ø§Ù„Ø© ØªØ¯ÙˆÙŠØ±
        document.getElementById('spinBtn').addEventListener('click', async () => {
            const spinBtn = document.getElementById('spinBtn');
            spinBtn.disabled = true;
            spinBtn.innerText = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ¯ÙˆÙŠØ±...';

            try {
                // Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù€ Google Apps Script Ù„ØªÙ†ÙÙŠØ° Ø§Ù„Ø¯ÙˆØ±Ø©
                const response = await fetch(appsScriptUrl, {
                    method: 'POST',
                    mode: 'no-cors', // Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… CARS if needed
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: new URLSearchParams({
                        action: 'spin',
                        userId: userId,
                        playBalance: currentPlayBalance
                    })
                });
                // Ø¨Ø³Ø¨Ø¨ no-cors Ù„Ø§ ÙŠÙ…ÙƒÙ† Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø±Ø¯ØŒ Ù„Ø°Ø§ Ø³Ù†ÙØªØ±Ø¶ Ù†Ø¬Ø§Ø­ Ù…Ø¤Ù‚Øª
                // Ø§Ù„Ø­Ù„ Ø§Ù„Ø£ÙØ¶Ù„: Ø§Ø³ØªØ®Ø¯Ø§Ù… JSONP Ø£Ùˆ ØªÙØ¹ÙŠÙ„ CORS ÙÙŠ Apps Script
                // Ø³Ù†Ù‚ÙˆÙ… Ø¨Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ø³ØªØ¬Ø§Ø¨Ø© (ÙŠØ¬Ø¨ ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§ Ø­Ø³Ø¨ Ø§Ù„Ø±Ø¯ Ø§Ù„ÙØ¹Ù„ÙŠ)
                
                // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© (ÙŠØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡Ø§ Ø¨Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©)
                const winAmount = Math.random() < 0.3 ? 2000 : 0; // ÙˆÙ‡Ù…ÙŠ
                const spinResult = simulateSpin(winAmount);
                
                // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø³Ù„ÙˆØªØ³
                const slotDivs = document.querySelectorAll('.slot');
                for (let i = 0; i < slotDivs.length; i++) {
                    slotDivs[i].innerText = spinResult.symbols[i];
                }

                if (winAmount > 0) {
                    document.getElementById('message').innerHTML = `ğŸ‰ Ø±Ø¨Ø­Øª ${winAmount}!`;
                } else {
                    document.getElementById('message').innerHTML = 'ğŸ˜ Ù„Ù… ØªØ±Ø¨Ø­ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø±Ø©';
                }

                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶
                if (currentPlayBalance === 'real') {
                    userData.balance -= 1000;
                    if (winAmount > 0) userData.balance += winAmount;
                    document.getElementById('realBalance').innerText = userData.balance;
                } else {
                    userData.bonus_balance -= 1000;
                    if (winAmount > 0) userData.bonus_balance += winAmount;
                    document.getElementById('bonusBalance').innerText = userData.bonus_balance;
                }

            } catch (e) {
                document.getElementById('message').innerHTML = 'âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±';
            } finally {
                spinBtn.disabled = false;
                spinBtn.innerText = 'ğŸ”„ ØªØ¯ÙˆÙŠØ± (1000)';
            }
        });

        // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø±Ù…ÙˆØ² Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙƒØ³Ø¨
        function simulateSpin(winAmount) {
            let symbolsResult = [];
            if (winAmount === 2000) {
                // 3 Ø±Ù…ÙˆØ² Ù…ØªØ´Ø§Ø¨Ù‡Ø©
                let sym = symbols[Math.floor(Math.random() * symbols.length)];
                for (let i = 0; i < 5; i++) {
                    symbolsResult.push(i < 3 ? sym : symbols[Math.floor(Math.random() * symbols.length)]);
                }
            } else if (winAmount === 4000) {
                let sym = symbols[Math.floor(Math.random() * symbols.length)];
                for (let i = 0; i < 5; i++) {
                    symbolsResult.push(i < 4 ? sym : symbols[Math.floor(Math.random() * symbols.length)]);
                }
            } else if (winAmount === 10000) {
                let sym = symbols[Math.floor(Math.random() * symbols.length)];
                for (let i = 0; i < 5; i++) symbolsResult.push(sym);
            } else {
                // Ù„Ø§ Ø±Ø¨Ø­: Ø±Ù…ÙˆØ² Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ù…Ø®ØªÙ„ÙØ©
                for (let i = 0; i < 5; i++) {
                    symbolsResult.push(symbols[Math.floor(Math.random() * symbols.length)]);
                }
            }
            return { symbols: symbolsResult };
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØµÙØ­Ø©
        loadUserData();
    </script>
</body>
</html>
